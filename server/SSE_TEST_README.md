# SSE æµ‹è¯•è„šæœ¬ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«ä¸¤ä¸ªSSEæµ‹è¯•è„šæœ¬ï¼Œç”¨äºæµ‹è¯•Server-Sent EventsåŠŸèƒ½ï¼š

1. `test_sse.js` - å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
2. `test_sse_simple.js` - ç®€å•å¿«é€Ÿæµ‹è¯•

## å‰ç½®æ¡ä»¶

1. ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼š
```bash
cd server
npm start
```

2. å®‰è£…ä¾èµ–ï¼š
```bash
npm install
```

## æµ‹è¯•è„šæœ¬

### 1. ç®€å•æµ‹è¯• (test_sse_simple.js)

å¿«é€ŸéªŒè¯SSEè¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```bash
node test_sse_simple.js
```

**æµ‹è¯•å†…å®¹ï¼š**
- å»ºç«‹SSEè¿æ¥
- æ¥æ”¶åˆå§‹åŒ–å’Œè¿æ¥äº‹ä»¶
- æ¥æ”¶å¿ƒè·³äº‹ä»¶
- å‘é€æµ‹è¯•é€šçŸ¥
- éªŒè¯äº‹ä»¶æ¥æ”¶

**é¢„æœŸè¾“å‡ºï¼š**
```
ğŸ§ª å¼€å§‹ç®€å•SSEæµ‹è¯•...
ğŸ”— è¿æ¥åœ°å€: http://localhost:3000/sse/connect?clientId=test-1234567890
âœ… SSEè¿æ¥å·²å»ºç«‹
ğŸ¯ æ”¶åˆ°initäº‹ä»¶: {"clientId":"test-1234567890","config":{"refreshInterval":5000},"timestamp":"2024-01-01T12:00:00.000Z"}
ğŸ¯ æ”¶åˆ°connectionäº‹ä»¶: {"clientId":"test-1234567890","message":"SSE connection established"}
ğŸ’“ æ”¶åˆ°heartbeat: {"status":"alive"}
ğŸ“¤ å‘é€æµ‹è¯•é€šçŸ¥...
âœ… é€šçŸ¥å‘é€æˆåŠŸ
ğŸ¨ æ”¶åˆ°customäº‹ä»¶: {"from":"server","message":"è¿™æ˜¯æµ‹è¯•æ¶ˆæ¯","timestamp":"2024-01-01T12:00:05.000Z"}

ğŸ“Š æµ‹è¯•ç»“æœ:
æ”¶åˆ° 4 ä¸ªäº‹ä»¶:
  1. init: {"clientId":"test-1234567890","config":{"refreshInterval":5000},"timestamp":"2024-01-01T12:00:00.000Z"}
  2. connection: {"clientId":"test-1234567890","message":"SSE connection established"}
  3. heartbeat: {"status":"alive"}
  4. custom: {"from":"server","message":"è¿™æ˜¯æµ‹è¯•æ¶ˆæ¯","timestamp":"2024-01-01T12:00:05.000Z"}
ğŸ”Œ è¿æ¥å·²å…³é—­
âœ… SSEæµ‹è¯•æˆåŠŸ!
ğŸ‰ æµ‹è¯•å®Œæˆ
```

### 2. å®Œæ•´æµ‹è¯•å¥—ä»¶ (test_sse.js)

è¿è¡Œå…¨é¢çš„SSEåŠŸèƒ½æµ‹è¯•ï¼š

```bash
node test_sse.js
```

**æµ‹è¯•å†…å®¹ï¼š**

1. **åŸºæœ¬è¿æ¥æµ‹è¯•**
   - å»ºç«‹å•ä¸ªSSEè¿æ¥
   - éªŒè¯äº‹ä»¶æ¥æ”¶
   - æ£€æŸ¥è¿æ¥çŠ¶æ€

2. **å¤šå®¢æˆ·ç«¯è¿æ¥æµ‹è¯•**
   - åŒæ—¶å»ºç«‹å¤šä¸ªè¿æ¥
   - éªŒè¯æ¯ä¸ªå®¢æˆ·ç«¯éƒ½èƒ½æ­£å¸¸æ¥æ”¶äº‹ä»¶
   - æµ‹è¯•å¹¶å‘è¿æ¥å¤„ç†

3. **äº‹ä»¶å‘é€æµ‹è¯•**
   - å‘é€ç»™ç‰¹å®šå®¢æˆ·ç«¯
   - å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯
   - éªŒè¯äº‹ä»¶ç±»å‹å’Œå†…å®¹

4. **è¿æ¥æ–­å¼€é‡è¿æµ‹è¯•**
   - æ¨¡æ‹Ÿè¿æ¥æ–­å¼€
   - æµ‹è¯•é‡æ–°è¿æ¥
   - éªŒè¯é‡è¿åçš„åŠŸèƒ½

5. **å‹åŠ›æµ‹è¯•**
   - åˆ›å»º10ä¸ªå¹¶å‘è¿æ¥
   - æµ‹è¯•æœåŠ¡å™¨è´Ÿè½½èƒ½åŠ›
   - éªŒè¯äº‹ä»¶åˆ†å‘æ€§èƒ½

**é¢„æœŸè¾“å‡ºï¼š**
```
ğŸš€ å¼€å§‹SSEæµ‹è¯•å¥—ä»¶...

ğŸ§ª æµ‹è¯•1: åŸºæœ¬è¿æ¥æµ‹è¯•
ğŸ”— åˆ›å»ºSSEè¿æ¥: http://localhost:3000/sse/connect?clientId=test-client-1234567890-abc123
âœ… è¿æ¥å·²å»ºç«‹: test-client-1234567890-abc123
ğŸ¯ æ”¶åˆ°initäº‹ä»¶ [test-client-1234567890-abc123]: {"clientId":"test-client-1234567890-abc123","config":{"refreshInterval":5000},"timestamp":"2024-01-01T12:00:00.000Z"}
ğŸ¯ æ”¶åˆ°connectionäº‹ä»¶ [test-client-1234567890-abc123]: {"clientId":"test-client-1234567890-abc123","message":"SSE connection established"}
ğŸ’“ æ”¶åˆ°heartbeat [test-client-1234567890-abc123]: {"status":"alive"}
ğŸ“Š æ”¶åˆ° 3 ä¸ªäº‹ä»¶
  1. init: {"clientId":"test-client-1234567890-abc123","config":{"refreshInterval":5000},"timestamp":"2024-01-01T12:00:00.000Z"}
  2. connection: {"clientId":"test-client-1234567890-abc123","message":"SSE connection established"}
  3. heartbeat: {"status":"alive"}
ğŸ”Œ è¿æ¥å·²å…³é—­: test-client-1234567890-abc123

ğŸ§ª æµ‹è¯•2: å¤šå®¢æˆ·ç«¯è¿æ¥æµ‹è¯•
ğŸ”— åˆ›å»ºSSEè¿æ¥: http://localhost:3000/sse/connect?clientId=test-client-1234567890-def456
âœ… è¿æ¥å·²å»ºç«‹: test-client-1234567890-def456
ğŸ”— åˆ›å»ºSSEè¿æ¥: http://localhost:3000/sse/connect?clientId=test-client-1234567890-ghi789
âœ… è¿æ¥å·²å»ºç«‹: test-client-1234567890-ghi789
ğŸ”— åˆ›å»ºSSEè¿æ¥: http://localhost:3000/sse/connect?clientId=test-client-1234567890-jkl012
âœ… è¿æ¥å·²å»ºç«‹: test-client-1234567890-jkl012
âœ… æˆåŠŸåˆ›å»º 3 ä¸ªè¿æ¥
ğŸ“Š test-client-1234567890-def456: 3 ä¸ªäº‹ä»¶
ğŸ“Š test-client-1234567890-ghi789: 3 ä¸ªäº‹ä»¶
ğŸ“Š test-client-1234567890-jkl012: 3 ä¸ªäº‹ä»¶
ğŸ”Œ è¿æ¥å·²å…³é—­: test-client-1234567890-def456
ğŸ”Œ è¿æ¥å·²å…³é—­: test-client-1234567890-ghi789
ğŸ”Œ è¿æ¥å·²å…³é—­: test-client-1234567890-jkl012

ğŸ§ª æµ‹è¯•3: äº‹ä»¶å‘é€æµ‹è¯•
ğŸ”— åˆ›å»ºSSEè¿æ¥: http://localhost:3000/sse/connect?clientId=test-client-1234567890-mno345
âœ… è¿æ¥å·²å»ºç«‹: test-client-1234567890-mno345
ğŸ“¤ å‘é€ç»™ç‰¹å®šå®¢æˆ·ç«¯...
ğŸ“¤ å‘é€é€šçŸ¥æˆåŠŸ: { success: true }
ğŸ“¤ å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯...
ğŸ“¤ å‘é€é€šçŸ¥æˆåŠŸ: { success: true }
ğŸ“Š æ”¶åˆ° 1 ä¸ªcustomäº‹ä»¶
ğŸ“Š æ”¶åˆ° 1 ä¸ªannouncementäº‹ä»¶
ğŸ”Œ è¿æ¥å·²å…³é—­: test-client-1234567890-mno345

ğŸ§ª æµ‹è¯•4: è¿æ¥æ–­å¼€é‡è¿æµ‹è¯•
ğŸ”— åˆ›å»ºSSEè¿æ¥: http://localhost:3000/sse/connect?clientId=test-client-1234567890-pqr678
âœ… è¿æ¥å·²å»ºç«‹: test-client-1234567890-pqr678
ğŸ”Œ è¿æ¥å·²å…³é—­: test-client-1234567890-pqr678
ğŸ”Œ è¿æ¥å·²æ–­å¼€
ğŸ”— åˆ›å»ºSSEè¿æ¥: http://localhost:3000/sse/connect?clientId=test-client-1234567890-pqr678
âœ… è¿æ¥å·²å»ºç«‹: test-client-1234567890-pqr678
ğŸ“Š é‡è¿åæ”¶åˆ° 3 ä¸ªäº‹ä»¶
ğŸ”Œ è¿æ¥å·²å…³é—­: test-client-1234567890-pqr678

ğŸ§ª æµ‹è¯•5: å‹åŠ›æµ‹è¯•
ğŸš€ åˆ›å»º 10 ä¸ªå¹¶å‘è¿æ¥...
ğŸ”— åˆ›å»ºSSEè¿æ¥: http://localhost:3000/sse/connect?clientId=test-client-1234567890-stu901
âœ… è¿æ¥å·²å»ºç«‹: test-client-1234567890-stu901
ğŸ”— åˆ›å»ºSSEè¿æ¥: http://localhost:3000/sse/connect?clientId=test-client-1234567890-vwx234
âœ… è¿æ¥å·²å»ºç«‹: test-client-1234567890-vwx234
...
âœ… æˆåŠŸåˆ›å»º 10 ä¸ªè¿æ¥
ğŸ“Š æ€»å…±æ”¶åˆ° 30 ä¸ªäº‹ä»¶
ğŸ”Œ è¿æ¥å·²å…³é—­: test-client-1234567890-stu901
ğŸ”Œ è¿æ¥å·²å…³é—­: test-client-1234567890-vwx234
...

ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»:
==================================================
1. åŸºæœ¬è¿æ¥æµ‹è¯•: âœ… PASS
   äº‹ä»¶æ•°: 3
2. å¤šå®¢æˆ·ç«¯è¿æ¥æµ‹è¯•: âœ… PASS
   å®¢æˆ·ç«¯æ•°: 3
   æ€»äº‹ä»¶æ•°: 9
3. äº‹ä»¶å‘é€æµ‹è¯•: âœ… PASS
   Customäº‹ä»¶: 1
   Announcementäº‹ä»¶: 1
4. è¿æ¥æ–­å¼€é‡è¿æµ‹è¯•: âœ… PASS
   äº‹ä»¶æ•°: 3
5. å‹åŠ›æµ‹è¯•: âœ… PASS
   å®¢æˆ·ç«¯æ•°: 10
   æ€»äº‹ä»¶æ•°: 30

==================================================
æ€»è®¡: 5 é€šè¿‡, 0 å¤±è´¥
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡!

ğŸ§¹ æ¸…ç†æ‰€æœ‰è¿æ¥...
âœ… æ¸…ç†å®Œæˆ
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**
   ```
   âŒ SSEè¿æ¥é”™è¯¯: Error: connect ECONNREFUSED 127.0.0.1:3000
   ```
   **è§£å†³æ–¹æ¡ˆï¼š** ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œæ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®

2. **æ²¡æœ‰æ”¶åˆ°äº‹ä»¶**
   ```
   âŒ SSEæµ‹è¯•å¤±è´¥: æ²¡æœ‰æ”¶åˆ°ä»»ä½•äº‹ä»¶
   ```
   **è§£å†³æ–¹æ¡ˆï¼š** 
   - æ£€æŸ¥SSEè·¯ç”±æ˜¯å¦æ­£ç¡®é…ç½®
   - éªŒè¯SSEç®¡ç†å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - æ£€æŸ¥å¿ƒè·³é—´éš”è®¾ç½®

3. **ä¾èµ–é”™è¯¯**
   ```
   Error: Cannot find module 'eventsource'
   ```
   **è§£å†³æ–¹æ¡ˆï¼š** è¿è¡Œ `npm install` å®‰è£…ä¾èµ–

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—**
   ```bash
   npm run dev
   ```

2. **æ£€æŸ¥SSEè·¯ç”±**
   ```bash
   curl http://localhost:3000/sse/connect?clientId=test
   ```

3. **æµ‹è¯•é€šçŸ¥API**
   ```bash
   curl -X POST http://localhost:3000/sse/notify \
     -H "Content-Type: application/json" \
     -d '{"clientId":"test","message":"test"}'
   ```

## è‡ªå®šä¹‰æµ‹è¯•

ä½ å¯ä»¥ä¿®æ”¹æµ‹è¯•è„šæœ¬ä¸­çš„å‚æ•°ï¼š

```javascript
// ä¿®æ”¹æœåŠ¡å™¨åœ°å€
const tester = new SSETester('http://your-server:3000');

// ä¿®æ”¹æµ‹è¯•å‚æ•°
await tester.testStressTest(20); // æµ‹è¯•20ä¸ªå¹¶å‘è¿æ¥
```

## æ€§èƒ½ç›‘æ§

æµ‹è¯•è„šæœ¬ä¼šè¾“å‡ºè¯¦ç»†çš„æ€§èƒ½ä¿¡æ¯ï¼š
- è¿æ¥å»ºç«‹æ—¶é—´
- äº‹ä»¶æ¥æ”¶æ•°é‡
- å¹¶å‘è¿æ¥å¤„ç†èƒ½åŠ›
- å†…å­˜ä½¿ç”¨æƒ…å†µ

è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©ä½ ä¼˜åŒ–SSEæœåŠ¡çš„æ€§èƒ½ã€‚ 